(this.webpackJsonptiny_app=this.webpackJsonptiny_app||[]).push([[0],{117:function(e,n,t){"use strict";t.r(n);var r=t(18),a=t(19),o=t.n(a),c=t(22),i=t(0),u=t.n(i),l=t(52),s=t.n(l);t(69),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var m=t(15),f=t(26),b=t(10),d=(t(70),t(60)),g=t(5),p=function(){return u.a.createElement("div",null,"Home")},v=function(){return u.a.createElement("div",null,"Host")},h=function(){return u.a.createElement("div",null,"Listing")},O=t(17);function E(){var e=Object(O.a)(["\n    mutation DeleteListing($id: ID!){\n        deleteListing(id: $id){\n            id\n        }\n    }\n"]);return E=function(){return e},e}function j(){var e=Object(O.a)(["\n    query Listings{\n            listings {\n                id ,\n                title\n            }\n        }\n    "]);return j=function(){return e},e}var w=Object(m.b)(j()),k=Object(m.b)(E()),I=function(e){e.title;var n=Object(f.c)(w),t=n.data,a=n.refetch,i=n.loading,l=n.error,s=Object(f.b)(k),m=Object(r.a)(s,2),b=m[0],d=m[1],g=(d.loading,d.error,function(){var e=Object(c.a)(o.a.mark((function e(n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b({variables:{id:n}});case 2:a();case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),p=t?u.a.createElement("ul",null,t.listings.map((function(e){return u.a.createElement("li",{key:e.id},e.title,u.a.createElement("button",{onClick:function(){g(e.id)}},"Delete"))}))):null;return i?u.a.createElement("h1",null,"Loading.."):l?u.a.createElement("h1",null,"Some Error.."):u.a.createElement("div",null,u.a.createElement("h2",null,p))},x=function(){return u.a.createElement("div",null,"NotFound")},y=t(119);function C(){var e=Object(O.a)(["\n    mutation LogOut{\n        logOut{\n            id\n            token\n            avatar\n            hasWallet\n            didRequest\n        }\n    }\n"]);return C=function(){return e},e}var L=Object(m.b)(C()),S=y.a.Content,R=function(e){var n=e.setViewer,t=Object(f.b)(L,{onCompleted:function(e){e&&e.logOut&&n(e.logOut)}}),a=Object(r.a)(t,1)[0];return u.a.createElement("div",null,"User",u.a.createElement(S,null,u.a.createElement("button",{onClick:function(){a(),sessionStorage.removeItem("token")}},"LogOut")))};function q(){var e=Object(O.a)(["\n    query AUTHURL{\n        authUrl\n    }\n"]);return q=function(){return e},e}var U=Object(m.b)(q());function W(){var e=Object(O.a)(["\n    mutation LogIn($input:LogInInput){\n        logIn(input:$input){\n            id\n            token\n            avatar\n            hasWallet\n            didRequest\n        }\n    }\n"]);return W=function(){return e},e}var $=Object(m.b)(W()),V=y.a.Content,D=function(e){var n=e.setViewer,t=Object(f.a)(),a=Object(f.b)($,{onCompleted:function(e){e&&e.logIn&&e.logIn.token&&(n(e.logIn),sessionStorage.setItem("token",e.logIn.token))}}),l=Object(r.a)(a,2),s=l[0],m=l[1],b=m.data,d=(m.loading,m.error,Object(i.useRef)(s));Object(i.useEffect)((function(){var e=new URL(window.location.href).searchParams.get("code");e&&d.current({variables:{input:{code:e}}})}),[]);var p=function(){var e=Object(c.a)(o.a.mark((function e(){var n,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.query({query:U});case 3:n=e.sent,r=n.data,window.location.href=r.authUrl,e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),new Error("Sorry! we were unable to login. Please try again later");case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();if(b&&b.logIn){var v=b.logIn.id;return u.a.createElement(g.a,{to:"/user/".concat(v)})}return u.a.createElement(V,null,u.a.createElement("button",{onClick:p},"Signin with google"))},F=new m.a({uri:"/api",request:function(){var e=Object(c.a)(o.a.mark((function e(n){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=sessionStorage.getItem("X-CSRF-TOKEN"),n.setContext({headers:{"X-CSRF-TOKEN":t||""}});case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()}),H={id:null,token:null,avatar:null,hasWallet:null,didRequest:!1},N=function(){var e=Object(i.useState)(H),n=Object(r.a)(e,2),t=(n[0],n[1]),a=Object(f.b)($,{onCompleted:function(e){e&&e.logIn&&(t(e.logIn),e.logIn.token?sessionStorage.setItem("token",e.logIn.token):sessionStorage.removeItem("token"))}}),o=Object(r.a)(a,2),c=o[0],l=(o[1].error,Object(i.useRef)(c));return Object(i.useEffect)((function(){l.current()}),[]),u.a.createElement(d.a,null,u.a.createElement(g.d,null,u.a.createElement(g.b,{exact:!0,path:"/",component:p}),u.a.createElement(g.b,{exact:!0,path:"/user/:id",render:function(e){return u.a.createElement(R,Object.assign({},e,{setViewer:t}))}}),u.a.createElement(g.b,{exact:!0,path:"/host",component:v}),u.a.createElement(g.b,{exact:!0,path:"/listing/:id",component:h}),u.a.createElement(g.b,{exact:!0,path:"/listings/:location?",component:I}),u.a.createElement(g.b,{exact:!0,path:"/login",render:function(e){return u.a.createElement(D,Object.assign({},e,{setViewer:t}))}}),u.a.createElement(g.b,{component:x})))};s.a.render(u.a.createElement(b.a,{client:F},u.a.createElement(N,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},63:function(e,n,t){e.exports=t(117)},69:function(e,n,t){},70:function(e,n,t){}},[[63,1,2]]]);
//# sourceMappingURL=main.ad3ca202.chunk.js.map